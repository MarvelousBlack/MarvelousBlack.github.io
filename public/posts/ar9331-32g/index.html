<!DOCTYPE html>
<html><head lang="en">
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>U 盤 wifi 縫合鉅作 AR9331 32G - 惠狐之书</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="說是 U 盤和 wifi 的縫合鉅作，實際上就是個十分便宜，從x寶淘回來的辣雞。" />
	<meta property="og:image" content=""/>
	<meta property="og:title" content="U 盤 wifi 縫合鉅作 AR9331 32G" />
<meta property="og:description" content="說是 U 盤和 wifi 的縫合鉅作，實際上就是個十分便宜，從x寶淘回來的辣雞。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.megumifox.com/public/posts/ar9331-32g/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-06-28T11:06:58+08:00" />
<meta property="article:modified_time" content="2019-06-28T11:06:58+08:00" />
<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="U 盤 wifi 縫合鉅作 AR9331 32G"/>
<meta name="twitter:description" content="說是 U 盤和 wifi 的縫合鉅作，實際上就是個十分便宜，從x寶淘回來的辣雞。"/>
<script src="https://blog.megumifox.com/public/js/feather.min.js"></script>
	
	
        <link href="https://blog.megumifox.com/public/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="https://blog.megumifox.com/public/css/main.ac08a4c9714baa859217f92f051deb58df2938ec352b506df655005dcaf98cc0.css" />
		<link id="darkModeStyle" rel="stylesheet" type="text/css" href="https://blog.megumifox.com/public/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css"  disabled />
	

	
	

	
	
	
	

       
       
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HM61C25V9Q"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-HM61C25V9Q', { 'anonymize_ip': false });
}
</script>

       

</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="https://blog.megumifox.com/public/">惠狐之书</a>
	</div>
	<nav>
		
		<a href="/public/">Home</a>
		
		<a href="/public/posts">All posts</a>
		
		<a href="/public/topics">Topics</a>
		
		<a href="/public/about">About</a>
		
		<a href="/public/friends">Friends</a>
		
		| <span id="dark-mode-toggle" onclick="toggleTheme()"></span>
		<script src="https://blog.megumifox.com/public/js/themetoggle.js"></script>
		
	</nav>

</header>

<main>
	<article>
		<div class="title">
			<h1 class="title">U 盤 wifi 縫合鉅作 AR9331 32G</h1>
			<div class="meta">Posted on Jun 28, 2019</div>
		</div>
		

		<section class="body">
			<h2 id="0x00-前言">0x00 前言</h2>
<p>說是 U 盤和 wifi 的縫合鉅作，實際上就是個十分便宜，從x寶淘回來的辣雞。</p>
<h2 id="0x01-爲什麼要購買這個">0x01 爲什麼要購買這個？</h2>
<p>其實是在某一天在羣裏看見了這個<br>
<img src="https://i.yusa.me/lLiQb8qoJ0j7.jpg" alt="baopic"><br>
咱看了看，正好缺個隨身碟，所以就買了下來。（買之前看了看評論似乎可以魔改，加個網口什麼的。<br>
而且最最最令咱感到興趣的是這個隨身碟是怎麼工作的呢？到底是怎麼判斷兩個 host 訪問一個盤的問題？那只好買一個咯。恰好是 618 ，可以用。。。額沒有，什麼劵咱都沒有，直接買好了。</p>
<h2 id="0x02-開箱和隨身碟的玉照">0x02 開箱和隨身碟的玉照</h2>
<p>嘛，快遞很快就到了，從東莞發過來的。然後拿出包裹的時候發現，怎麼除了那一包泡沫紙，好像還有點什麼？全部倒出來，發現賣家送了一包毛巾，在同一家店裏可以找到，賣6元。=。= 擦桌子用剛剛好。
下面是圖：（由於這個 blog 的模板問題,咱不知道圖片要怎麼處理所以直接貼好了）<br>
<img src="/public/pic/ar9331-32g0.jpg" alt="ar9331-32G0"><br>
隨身碟的圖（請忽略下面那塊 keyboard）
<img src="/public/pic/ar9331-32g1.jpg" alt="ar9331-32G1"><br>
<img src="/public/pic/ar9331-32g2.jpg" alt="ar9331-32G2"></p>
<h1 id="0x03-上面的元件">0x03 上面的元件</h1>
<p>這個可以看由大風車（@dfceaef ）寫的 <a href="https://kirikira.moe/post/38/">USB缝合巨作赏析</a>，咱就不重複了。（裏面還有魔改教程</p>
<h1 id="0x04-前世">0x04 前世</h1>
<p>這個隨身碟很容易讓人想起之在前 11 年到 14 年左右，有一大堆帶 wifi 的 U 盤產品。那麼這個東西的前世是不是這種東西裏面的某一個呢？打開開關，鏈接這小傢伙的wifi，然後訪問頁面 <a href="http://192.168.222.254">192.168.222.254</a>, emmm，熟悉的界面和品勝之前的移動電源差不多，只是沒品勝的字樣，應該是同一個方案。在頁面中可以看見 airdisk 的字樣，於是隨手搜一下，可以發現是一個叫 <a href="https://www.airdisk.cc/products/p-1.html">AirDisk 存宝 A4-加密无线U盘</a> 的東西，而且還能在某網站找到這個產品的拆解，這個拆解圖和咱手上的板子一模一樣，還帶電池（就是前面的圖中USB隔壁的那兩個巨大的孔的用途），於是可以確認是這個東西了。</p>
<h1 id="0x05-使用和體驗">0x05 使用和體驗</h1>
<p>先說缺點，由於是幾年前的產品，無線傳輸速度嘛，能用就行。但由於這個東西實在是太肥了，會擋住其他的接口，可以看下圖：<br>
<img src="/public/pic/ar9331-32g3.jpg" alt="ar9331-32G3"><br>
這個一個 usb hub 咱拿來插手機，用來用三星 dex ，汝可以看見，這個盤實在是太肥了，HDMI 接口被擋住了。QAQ 插電腦上就是佔了兩個 usb 口。目前看來還是只有這個缺點。<br>
U盤嘛，容量是正常的,但這個盤到手的時候是空的，就是連分區表都沒有。直接插 windows 的話會直接提示是否格式化，直接格式化就好了。格式化成 NTFS 也是可以的，無線鏈接也是能讀NTFS格式的。這塊盤宣稱 80 寫 40 ，於是咱測了一下手上的，看圖吧：<br>
<img src="/public/pic/ar9331-32g4.jpg" alt="ar9331-32G4"><br>
<strong>注意當這個盤插電腦的時候 AR9331 是不會發現盤的，在 wifi 的後臺頁面是看不見盤的，所以要用的時候請把這個插到充電寶或者電源插座是上。</strong></p>
<h1 id="0x06-探索">0x06 探索</h1>
<p>前面提到了十分好奇他是怎麼工作的，於是摸索了一下。前文提到了這個可以想起和品勝可能是同一個方案，於是直接 telnet 進去。從裙友處搞來登錄用戶和密碼。用戶爲 <code>root</code> 密碼 <code>buzhidao</code> 。 對，沒錯密碼就是不知道。汝密碼是啥？不知道。什麼不知道？我說密碼就是不知道的拼音。= =<br>
之後咱們就可以看見</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>BusyBox v1.19.3 <span style="color:#f92672">(</span>2013-07-26 14:33:40 CST<span style="color:#f92672">)</span> built-in shell <span style="color:#f92672">(</span>ash<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Enter <span style="color:#e6db74">&#39;help&#39;</span> <span style="color:#66d9ef">for</span> a list of built-in commands.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  _______                     ________        __
</span></span><span style="display:flex;"><span> |       |.-----.-----.-----.|  |  |  |.----.|  |_
</span></span><span style="display:flex;"><span> |   -   <span style="color:#f92672">||</span>  _  |  -__|     <span style="color:#f92672">||</span>  |  |  <span style="color:#f92672">||</span>   _<span style="color:#f92672">||</span>   _|
</span></span><span style="display:flex;"><span> |_______<span style="color:#f92672">||</span>   __|_____|__|__<span style="color:#f92672">||</span>________<span style="color:#f92672">||</span>__|  |____|
</span></span><span style="display:flex;"><span>          |__| W I R E L E S S   F R E E D O M
</span></span><span style="display:flex;"><span> ATTITUDE ADJUSTMENT <span style="color:#f92672">(</span>bleeding edge, r93<span style="color:#f92672">)</span> ----------
</span></span><span style="display:flex;"><span>  * 1/4 oz Vodka      Pour all ingredients into mixing
</span></span><span style="display:flex;"><span>  * 1/4 oz Gin        tin with ice, strain into glass.
</span></span><span style="display:flex;"><span>  * 1/4 oz Amaretto
</span></span><span style="display:flex;"><span>  * 1/4 oz Triple sec
</span></span><span style="display:flex;"><span>  * 1/4 oz Peach schnapps
</span></span><span style="display:flex;"><span>  * 1/4 oz Sour mix
</span></span><span style="display:flex;"><span>  * <span style="color:#ae81ff">1</span> splash Cranberry juice
</span></span><span style="display:flex;"><span> -----------------------------------------------------
</span></span></code></pre></div><p>上古 openwrt 的提示，摸索了一下發現和品勝那個差不多，燈和 reset 是一樣的，直接刷品勝的固件好了。貼一下 dmesg 吧。<br>
<a href="https://fars.ee/QVMv">插電腦 dmesg</a> <a href="https://fars.ee/qmsT">不插電腦 dmesg</a><br>
沒區別，其實也就是有沒有掛盤的區別和<code>wifi_udisk_timer 22status</code> 後面的數字不同，但咱不懂是啥。先順手刷個 breed 進去和備份一下，直接 dd 到 u 盤就好了， breed 直接 mtd write 就好了。然後從 U 盤把備份等拉回電腦。恩，不是提到了他是插電腦 ar9331 是找不到設備的嗎？這個做法很簡單，用一個 USB switch 來選通就好了，仔細找找可以發現一個 7227 的芯片，這個就是 USB switch 。接着就是判斷和選擇誰鏈接了。這就解釋了之前提出的問題，怎麼一起讀盤？ 選擇就好了，此時只有一個設備可以讀盤也就解決了這個問題，不會同時存在兩個 host 同時讀盤。在這個過程中咱找到了另一個設備，也是類似的東西，一個叫 <a href="https://openwrt.org/toh/zsun/wifi-card-reader">Zsun wifi card reader</a> 的東西，也是有個讀卡器和一個 USB 選通，於是咱猜是相同的做法。接着爲了找到這塊板子上的 gpio 口，咱編譯了一個品勝的刷了（直接 sysupgrade ）進去。emmm，很快咱們就知道了<code>GPIO20</code>判斷是不是插了電腦，沒插爲0,插了爲1。接着<code>GPIO22</code>控制選通芯片，讀卡器連電腦爲0,連 ar9331 的時候爲1。默認的時候是連電腦的。這個也同時解釋了，爲什麼插到電腦上一開始會提示設備鏈接，設備斷開，來回一次的情況了。恩，目前大概就做到這裏。下面是下面是刷入後的截圖：<br>
<img src="/public/pic/ar9331-32g5.png" alt="ar9331-32G5"></p>
<h1 id="0x07-結語">0x07 結語</h1>
<p>大概就是這樣，但咱還是打算用來做 U 盤所以連 wifi 功能都用不上，所以把開關一撥就好了直接關掉。拿到這個東西還是很高興的，而且在這個過程中也沒有翻車。25 元買 32G 的 U 盤還算是挺值的。</p>

		</section>

		<div class="post-tags">
			
			
			<nav class="nav tags">
				<ul class="tags">
					
					<li><a href="/public/tags/usb">usb</a></li>
					
					<li><a href="/public/tags/ar9331">ar9331</a></li>
					
				</ul>
			</nav>
			
			
		</div>
		<div id="disqus_thread"></div>
<script type="text/javascript">
    (function () {
        
        
        if (window.location.hostname == "localhost")
            return;

        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        var disqus_shortname = 'megumifox';
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
        Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></article>
</main>
<footer>
  <div style="display:flex"><a class="soc" href="/public/index.xml" rel="me" title=""><i data-feather="rss"></i></a>
    <a class="border"></a><a class="soc" href="https://github.com/MarvelousBlack" rel="me" title=""><i data-feather="github"></i></a>
    <a class="border"></a></div>
  <div class="footer-info">
    2024  © 惠狐之书 |  <a
      href="https://github.com/athul/archie">Archie Theme</a> | 所有的文章除特别声明外，均使用 <a href="https://blog.megumifox.com/public/license">CC BY-NC-SA 4.0</a>。
  </div>
</footer><script>
  feather.replace()
</script></div>
    </body>
</html>
