---
title: "U 盤 wifi 縫合鉅作 AR9331 32G"
date: 2019-06-28T11:06:58+08:00
description: "說是 U 盤和 wifi 的縫合鉅作，實際上就是個十分便宜，從x寶淘回來的辣雞。"
topics:
  - 琐碎的事
  - 杂乱的笔记
tags:
  - usb
  - ar9331
draft:  false
---

## 0x00 前言
說是 U 盤和 wifi 的縫合鉅作，實際上就是個十分便宜，從x寶淘回來的辣雞。

## 0x01 爲什麼要購買這個？
其實是在某一天在羣裏看見了這個   
![baopic](https://i.yusa.me/lLiQb8qoJ0j7.jpg)  
咱看了看，正好缺個隨身碟，所以就買了下來。（買之前看了看評論似乎可以魔改，加個網口什麼的。  
而且最最最令咱感到興趣的是這個隨身碟是怎麼工作的呢？到底是怎麼判斷兩個 host 訪問一個盤的問題？那只好買一個咯。恰好是 618 ，可以用。。。額沒有，什麼劵咱都沒有，直接買好了。

## 0x02 開箱和隨身碟的玉照
嘛，快遞很快就到了，從東莞發過來的。然後拿出包裹的時候發現，怎麼除了那一包泡沫紙，好像還有點什麼？全部倒出來，發現賣家送了一包毛巾，在同一家店裏可以找到，賣6元。=。= 擦桌子用剛剛好。
下面是圖：（由於這個 blog 的模板問題,咱不知道圖片要怎麼處理所以直接貼好了）  
![ar9331-32G0](/public/pic/ar9331-32g0.jpg)  
隨身碟的圖（請忽略下面那塊 keyboard）
![ar9331-32G1](/public/pic/ar9331-32g1.jpg)  
![ar9331-32G2](/public/pic/ar9331-32g2.jpg)  

# 0x03 上面的元件
這個可以看由大風車（@dfceaef ）寫的 [USB缝合巨作赏析](https://kirikira.moe/post/38/)，咱就不重複了。（裏面還有魔改教程

# 0x04 前世
這個隨身碟很容易讓人想起之在前 11 年到 14 年左右，有一大堆帶 wifi 的 U 盤產品。那麼這個東西的前世是不是這種東西裏面的某一個呢？打開開關，鏈接這小傢伙的wifi，然後訪問頁面 [192.168.222.254](http://192.168.222.254), emmm，熟悉的界面和品勝之前的移動電源差不多，只是沒品勝的字樣，應該是同一個方案。在頁面中可以看見 airdisk 的字樣，於是隨手搜一下，可以發現是一個叫 [AirDisk 存宝 A4-加密无线U盘](https://www.airdisk.cc/products/p-1.html) 的東西，而且還能在某網站找到這個產品的拆解，這個拆解圖和咱手上的板子一模一樣，還帶電池（就是前面的圖中USB隔壁的那兩個巨大的孔的用途），於是可以確認是這個東西了。

# 0x05 使用和體驗
先說缺點，由於是幾年前的產品，無線傳輸速度嘛，能用就行。但由於這個東西實在是太肥了，會擋住其他的接口，可以看下圖：  
![ar9331-32G3](/public/pic/ar9331-32g3.jpg)  
這個一個 usb hub 咱拿來插手機，用來用三星 dex ，汝可以看見，這個盤實在是太肥了，HDMI 接口被擋住了。QAQ 插電腦上就是佔了兩個 usb 口。目前看來還是只有這個缺點。  
U盤嘛，容量是正常的,但這個盤到手的時候是空的，就是連分區表都沒有。直接插 windows 的話會直接提示是否格式化，直接格式化就好了。格式化成 NTFS 也是可以的，無線鏈接也是能讀NTFS格式的。這塊盤宣稱 80 寫 40 ，於是咱測了一下手上的，看圖吧：  
![ar9331-32G4](/public/pic/ar9331-32g4.jpg)  
**注意當這個盤插電腦的時候 AR9331 是不會發現盤的，在 wifi 的後臺頁面是看不見盤的，所以要用的時候請把這個插到充電寶或者電源插座是上。**

# 0x06 探索
前面提到了十分好奇他是怎麼工作的，於是摸索了一下。前文提到了這個可以想起和品勝可能是同一個方案，於是直接 telnet 進去。從裙友處搞來登錄用戶和密碼。用戶爲 `root` 密碼 `buzhidao` 。 對，沒錯密碼就是不知道。汝密碼是啥？不知道。什麼不知道？我說密碼就是不知道的拼音。= =  
之後咱們就可以看見  
```bash
BusyBox v1.19.3 (2013-07-26 14:33:40 CST) built-in shell (ash)
Enter 'help' for a list of built-in commands.

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 ATTITUDE ADJUSTMENT (bleeding edge, r93) ----------
  * 1/4 oz Vodka      Pour all ingredients into mixing
  * 1/4 oz Gin        tin with ice, strain into glass.
  * 1/4 oz Amaretto
  * 1/4 oz Triple sec
  * 1/4 oz Peach schnapps
  * 1/4 oz Sour mix
  * 1 splash Cranberry juice
 -----------------------------------------------------
 ```
上古 openwrt 的提示，摸索了一下發現和品勝那個差不多，燈和 reset 是一樣的，直接刷品勝的固件好了。貼一下 dmesg 吧。  
[插電腦 dmesg](https://fars.ee/QVMv) [不插電腦 dmesg](https://fars.ee/qmsT)  
沒區別，其實也就是有沒有掛盤的區別和` wifi_udisk_timer 22status ` 後面的數字不同，但咱不懂是啥。先順手刷個 breed 進去和備份一下，直接 dd 到 u 盤就好了， breed 直接 mtd write 就好了。然後從 U 盤把備份等拉回電腦。恩，不是提到了他是插電腦 ar9331 是找不到設備的嗎？這個做法很簡單，用一個 USB switch 來選通就好了，仔細找找可以發現一個 7227 的芯片，這個就是 USB switch 。接着就是判斷和選擇誰鏈接了。這就解釋了之前提出的問題，怎麼一起讀盤？ 選擇就好了，此時只有一個設備可以讀盤也就解決了這個問題，不會同時存在兩個 host 同時讀盤。在這個過程中咱找到了另一個設備，也是類似的東西，一個叫 [Zsun wifi card reader](https://openwrt.org/toh/zsun/wifi-card-reader) 的東西，也是有個讀卡器和一個 USB 選通，於是咱猜是相同的做法。接着爲了找到這塊板子上的 gpio 口，咱編譯了一個品勝的刷了（直接 sysupgrade ）進去。emmm，很快咱們就知道了` GPIO20 `判斷是不是插了電腦，沒插爲0,插了爲1。接着` GPIO22 `控制選通芯片，讀卡器連電腦爲0,連 ar9331 的時候爲1。默認的時候是連電腦的。這個也同時解釋了，爲什麼插到電腦上一開始會提示設備鏈接，設備斷開，來回一次的情況了。恩，目前大概就做到這裏。下面是下面是刷入後的截圖：  
![ar9331-32G5](/public/pic/ar9331-32g5.png)  

# 0x07 結語
大概就是這樣，但咱還是打算用來做 U 盤所以連 wifi 功能都用不上，所以把開關一撥就好了直接關掉。拿到這個東西還是很高興的，而且在這個過程中也沒有翻車。25 元買 32G 的 U 盤還算是挺值的。

