---
title: "Canokey 體驗"
date: 2021-03-20T13:37:26+08:00
draft: false
description: "在羣友安利下，我購入了 Canokey。恩，這是一個硬件密鑰，支援 U2F / FIDO2 、 OpenPGP Card V3.4 、 PIV 還有 OTP （one time password），而且價格還十分誘人，總的來說是個不錯的產品。那麼下面就來說說我用下來的體驗和遇到的問題。"
topics:
  - 杂乱的笔记
tags:
  - canokey
  - u2f
  - gpg
---
先聲明，我沒有 yubikey 自然也沒有用過相關的產品，這個算是我第一次接觸這種密碼學設備。額，是不是有人會覺得這又是什麼新的垃圾車，畢竟這 blog 大部分是提到的買回來的東西都是某電子垃圾場撿到的垃圾。不過這次的不是垃圾車，這是個正經的產品，而且也經過了小規模的測試，不是之前的那些電子垃圾！！！

## 0x00 買！
其實之前就想搞個硬件密鑰了，但是 yubikey 的價格實在是比較高，而且我也不方便弄一根，所以只好尋找代替品。這時候有羣友安利我說買 Canokey 。之後嘛，剛剛好趕上是第一批早鳥版只要 79CNY 就可以入手，於是馬上下單了一個。其實一開始沒有趕上，只是沒有滴膠的版本還有於是想着自己隨便套個熱縮管就好了，後面店主和我說算錯數量了，滴膠還有一個，要不要換，於是就換成了滴膠版。

## 0x01 支援範圍
在項目中，它提到了它支援以下的協議
```
U2F / FIDO2 with ed25519 and HMAC-secret
OpenPGP Card V3.4, Supported Algorithm List
PIV (NIST SP 800-73-4)
HOTP / TOTP
NDEF
```
這些都涵蓋了大部分我日常需要用到的範圍。還是十分吸引人的。Canokey 分爲開源版和閉源版。閉源版和開源版共用核心實現，但閉源版密碼學運算部分由於使用的芯片有 NDA 所以不能開源。剩下的例如 PCB 電路板等部分都是開源的。這部分可以在 [github.com/canokeys](https://github.com/canokeys/) 中找到。而且，這東西還帶 nfc 不錯誒，功能挺全的基本上我要的都有了。
我購入的是閉源版，因爲開源版的存在一定的問題，密鑰可能可以從 key 中拷貝出來是十分不安全的。當然閉源版聲稱核心代碼和開源的是同一份，但是這個也只有店主的口頭保證，沒法驗證(

# 0x02 開箱
等了幾天，終於拿到了，是一個紙袋包着，拆開裏面還有一個郵政的小塑料袋裝着，保護還是做的挺好的。掏出袋子就可以看見一個巨大的圈九。（ \バガ/ \バガ/　腦子裏面瞬間有聲音了）

# 0x03 早起的鳥兒有蟲喫（x
早鳥版嘛，很正常就是有蟲（BUG）喫。由於有些人快遞比較快，第一批就很早就拿到了，並且發現了問題並且報告了問題，在部分蘋果設備上會出現無法使用的問題。買的時候其實我已經知道了有這個問題而且我根本就沒有蘋果設備，所以選擇了忽視。但這個問題實際上是 USB 協商的問題，在某些控制器上無法 config ，並不是蘋果設備獨有的問題。一開始我也是沒有發現這個問題，直到我往電腦上掛了一個品勝的usb 2.0 的 hub。 發現不能使用並且 dmesg 上會出現：
```
[  153.776041] usb 2-2.2: can't set config #1, error -32
```
沒想到還是遇到了，沒辦法這是固件問題 ~~（土製USB）~~ ，Canokey 不能升級固件，只能去退換了。因爲問題發現的早，開發者很快就修好了問題，並且在第二批的早鳥版中修復了這個問題。

# 0x03 換回來了
再次開箱：

這次固件更新到了`1.2-0-g2f1f180e` usb config 的問題修好了，也就是說可以正常的使用了。

# 0x04 個人的用途和感受


# 0x05 目前還存在的問題
目前已經賣出去的早鳥版都有一個問題，具體參見[1](https://github.com/Yubico/libfido2/issues/322)，簡單說就是那個該死的不等於3[2](https://github.com/canokeys/canokey-core/blob/4cacb73ec275c3fa32da67305e9f5e4884fba05d/applets/ctap/ctap-parser.c#L407)（x,導致了和 FIDO 2.0 的要求不一樣，才出現了這個問題。這個問題也很好解決，因爲 canokey 的固件已經合併了提交，所以買新的就好了（

# 0x06 長期使用下來的感受
首先，滴膠並不是很好的防護，雖然板子還是完好的包住了。但是滴膠在日常的使用中已經出現了比較深的劃痕，而且很不耐刮，大大的影響觀感。當然滴膠版僅僅只是早鳥版的早期處理，問了一下作者，他們說外殼版已經在做了，但似乎一直都沒有恢復生產的跡象。總的來說還是個不錯的產品，希望正式版可以快點發售吧。
